name: SwiftUI API Gap Report

on:
  workflow_dispatch:
  schedule:
    # Every Monday at 09:00 UTC
    - cron: '0 9 * * 1'

permissions:
  contents: write
  pull-requests: write

jobs:
  generate-gap-report:
    name: Generate SwiftUI Gap Report
    runs-on: macos-26

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify toolchain
        run: |
          xcodebuild -version
          swift --version
          swift-api-digester -help >/dev/null

      - name: Generate report artifacts
        run: |
          chmod +x Scripts/swiftui_api_gap_report.py
          Scripts/swiftui_api_gap_report.py --repo-root . --output-dir Reports/swiftui-api-gap

      - name: Upload report artifacts
        uses: actions/upload-artifact@v4
        with:
          name: swiftui-api-gap-report
          path: Reports/swiftui-api-gap/
          if-no-files-found: error
          retention-days: 30

      - name: Create pull request with weekly report
        uses: peter-evans/create-pull-request@v7
        with:
          branch: codex/swiftui-api-gap-report
          commit-message: "chore: update SwiftUI API gap report"
          title: "chore: weekly SwiftUI API gap report update"
          body: |
            Automated weekly SwiftUI API gap report refresh.

            Generated by `.github/workflows/swiftui-api-gap-report.yml`.
          add-paths: |
            Reports/swiftui-api-gap/gap_report.md
          labels: |
            automation
            swiftui
            api-coverage
